<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple To-Do List</title>

    <!-- CSS is embedded in the <style> tag -->
    <style>
      /* General Body & Font Styling */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background-color: #f4f7f6; /* Modern soft background */
        color: #333;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        padding-top: 50px; /* Increased top padding */
      }

      /* Main App Container */
      .todo-container {
        width: 100%;
        max-width: 550px; /* Slightly wider */
        background-color: #fff;
        border-radius: 16px; /* More rounded */
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1),
          0 5px 10px rgba(0, 0, 0, 0.05); /* Enhanced shadow */
        padding: 30px 35px; /* Adjusted padding */
      }

      /* Header Styling */
      .todo-container h1 {
        color: #34495e; /* Deeper blue-gray */
        text-align: center;
        margin-bottom: 25px;
        font-size: 2.2em; /* Slightly larger */
        font-weight: 600; /* A bit bolder for impact */
      }

      /* Form & Input Styling */
      #task-form {
        display: flex;
        gap: 12px; /* Adjusted gap */
        margin-bottom: 30px; /* Increased margin */
        align-items: center; /* Vertically align items */
      }

      #task-input {
        flex-grow: 1;
        padding: 14px 18px; /* Increased padding */
        border: 1px solid #dfe6e9; /* Lighter border */
        border-radius: 8px; /* More rounded */
        font-size: 1.05em;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.04); /* Subtle inner shadow */
      }

      #task-input:focus {
        outline: none;
        border-color: #5c9dff; /* Modern blue for focus */
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.06),
          0 0 0 0.2rem rgba(92, 157, 255, 0.25); /* Enhanced focus shadow */
      }

      #task-priority {
        padding: 14px 12px; /* Consistent padding */
        border: 1px solid #dfe6e9;
        border-radius: 8px;
        font-size: 1em;
        background-color: #fff;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.04);
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
      }

      #task-priority:focus {
        outline: none;
        border-color: #5c9dff;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.06),
          0 0 0 0.2rem rgba(92, 157, 255, 0.25);
      }

      #add-task-btn {
        background-color: #5c9dff; /* Modern primary button color */
        color: white;
        border: none;
        padding: 0 25px; /* Increased padding */
        font-size: 1.05em;
        font-weight: 600; /* Bolder */
        border-radius: 8px; /* More rounded */
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.1s ease,
          box-shadow 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); /* Subtle shadow */
      }

      #add-task-btn:hover {
        background-color: #4a80d0; /* Darker shade for hover */
        transform: translateY(-1px); /* Slight lift */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12); /* Enhanced shadow on hover */
      }
      #add-task-btn:active {
        transform: scale(0.98) translateY(0px); /* Click feedback */
      }

      /* Task List Styling */
      #task-list {
        list-style-type: none;
        padding: 0;
        margin: 0;
      }

      /* Individual Task Item Styling */
      .task-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        background-color: #fff;
        border-bottom: 1px solid #eef2f5; /* Very light border */
        transition: background-color 0.3s ease, transform 0.2s ease,
          box-shadow 0.2s ease;
        border-radius: 8px; /* Rounded corners for task items */
        margin-bottom: 10px; /* Space between task items */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04); /* Subtle shadow for each item */
        position: relative; /* For priority indicator positioning */
      }

      /* Priority Indicator Styles */
      .task-item::before {
        content: "";
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: #ffc107;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
      }
      .task-item.priority-low::before {
        background-color: #28a745;
        box-shadow: 0 0 5px rgba(40, 167, 69, 0.3);
      }
      .task-item.priority-medium::before {
        background-color: #ffc107;
        box-shadow: 0 0 5px rgba(255, 193, 7, 0.3);
      }
      .task-item.priority-high::before {
        background-color: #dc3545;
        box-shadow: 0 0 5px rgba(220, 53, 69, 0.3);
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0% {
          transform: translateY(-50%) scale(1);
        }
        50% {
          transform: translateY(-50%) scale(1.2);
        }
        100% {
          transform: translateY(-50%) scale(1);
        }
      }

      .task-item:last-child {
        /* border-bottom: none; Keep border for consistency or remove if preferred */
        margin-bottom: 0; /* No margin for the last item if it's the only one or last */
      }
      .task-item:hover {
        background-color: #fcfdff; /* Very subtle hover background */
        transform: translateY(-2px); /* Lift effect on hover */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* Enhanced shadow on hover */
      }

      .task-item.empty-message {
        /* Styling for the empty state message */
        text-align: center;
        color: #6c757d;
        padding: 25px 15px;
        border-bottom: none;
        box-shadow: none;
        justify-content: center;
      }
      .task-item.empty-message:hover {
        /* Override hover for empty message */
        transform: none;
        box-shadow: none;
        background-color: #fff;
      }

      .task-item .task-text {
        flex-grow: 1;
        margin: 0 15px 0 32px; /* Adjusted left margin for priority indicator */
        font-size: 1.02em; /* Slightly larger task text */
        word-break: break-word; /* Prevent long text from breaking layout */
        cursor: pointer; /* Allows clicking the text to toggle completion */
      }

      /* Styling for the input field when editing a task */
      .task-item .edit-task-input {
        flex-grow: 1;
        margin: 0 15px;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      /* Completed Task Styling */
      .task-item.completed .task-text {
        text-decoration: line-through;
        color: #8492a6; /* Softer muted color */
      }

      /* Action Buttons Styling */
      .task-item .actions button {
        border: none;
        background-color: transparent;
        cursor: pointer;
        font-size: 1.2em;
        padding: 6px 8px; /* Adjusted padding */
        transition: color 0.3s ease;
      }

      .task-item .actions button:not(:last-child) {
        margin-right: 8px; /* Space between action buttons */
      }

      .task-item .complete-btn {
        color: #2ecc71; /* Brighter Green */
      }
      .task-item .complete-btn:hover {
        color: #27ae60; /* Darker Green */
      }

      .task-item .edit-btn {
        color: #f39c12; /* Orange for edit */
      }
      .task-item .edit-btn:hover {
        color: #d35400; /* Darker Orange */
      }

      .task-item .delete-btn {
        color: #e74c3c; /* Brighter Red */
      }
      .task-item .delete-btn:hover {
        color: #c0392b; /* Darker Red */
      }

      /* Clear Completed Button Styling */
      #clear-completed-btn {
        display: none; /* Hidden by default */
        margin: 20px auto 0; /* Center it and add top margin */
        padding: 12px 22px; /* Increased padding */
        background-color: #6c757d; /* Bootstrap secondary color */
        color: white;
        border: none;
        border-radius: 8px; /* More rounded */
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.1s ease,
          box-shadow 0.2s ease;
        font-weight: 500;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); /* Subtle shadow */
      }
      #clear-completed-btn:hover {
        background-color: #7f8c8d;
      }
    </style>
  </head>
  <body>
    <div class="todo-container">
      <h1>To-Do List</h1>
      <form id="task-form">
        <input
          type="text"
          id="task-input"
          placeholder="Add a new task..."
          autocomplete="off"
        />
        <select id="task-priority" aria-label="Task priority">
          <option value="medium">Medium</option>
          <option value="low">Low</option>
          <option value="high">High</option>
        </select>
        <button type="submit" id="add-task-btn">Add</button>
      </form>
      <ul id="task-list">
        <!-- Tasks will be dynamically added here by JavaScript -->
      </ul>
      <button id="clear-completed-btn">Clear Completed Tasks</button>
    </div>

    <!-- JavaScript is embedded in the <script> tag -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Select DOM elements
        const taskForm = document.getElementById("task-form");
        const taskInput = document.getElementById("task-input");
        const taskPriorityInput = document.getElementById("task-priority");
        const taskList = document.getElementById("task-list");
        const clearCompletedBtn = document.getElementById(
          "clear-completed-btn"
        );

        // --- FUNCTIONS ---

        // Function to fetch tasks from localStorage
        const getTasks = () => {
          // Get tasks from localStorage or initialize an empty array if none exist
          const tasks = localStorage.getItem("tasks");
          return tasks ? JSON.parse(tasks) : [];
        };

        // Function to save tasks to localStorage
        const saveTasks = (tasks) => {
          localStorage.setItem("tasks", JSON.stringify(tasks));
        };

        // Function to render tasks to the DOM
        const renderTasks = () => {
          // Clear the current list
          taskList.innerHTML = "";

          let hasCompletedTasks = false;
          // Get tasks from storage
          const tasks = getTasks();

          // Handle empty state
          if (tasks.length === 0) {
            const emptyLi = document.createElement("li");
            emptyLi.className = "task-item empty-message";
            emptyLi.textContent = "No tasks yet. Add one above!";
            taskList.appendChild(emptyLi);
            clearCompletedBtn.style.display = "none";
            return; // Exit early if no tasks
          }

          // Create and append each task item
          tasks.forEach((task, index) => {
            // Create list item
            const li = document.createElement("li");
            li.className = "task-item";

            // Add priority class (default to medium if undefined)
            const priority = task.priority || "medium";
            li.classList.add(`priority-${priority}`);

            if (task.completed) {
              li.classList.add("completed");
              hasCompletedTasks = true;
            }
            li.dataset.index = index;

            // Create task text span
            const taskText = document.createElement("span");
            taskText.className = "task-text";
            taskText.textContent = task.text;

            // Create action buttons container
            // Add ARIA attribute for priority to task text
            taskText.setAttribute(
              "aria-label",
              `${task.text}, priority ${priority}`
            );
            const actionsDiv = document.createElement("div");
            actionsDiv.className = "actions";

            // Create complete button
            const completeBtn = document.createElement("button");
            completeBtn.className = "complete-btn";
            if (task.completed) {
              completeBtn.innerHTML = "&#x21BA;"; // Undo symbol ↺
              completeBtn.setAttribute(
                "aria-label",
                `Mark task "${task.text}" as not complete`
              );
            } else {
              completeBtn.innerHTML = "&#x2714;"; // Checkmark symbol ✔
              completeBtn.setAttribute(
                "aria-label",
                `Mark task "${task.text}" as complete`
              );
            }
            completeBtn.setAttribute("aria-pressed", task.completed.toString());

            // Create edit button
            const editBtn = document.createElement("button");
            editBtn.className = "edit-btn";
            editBtn.innerHTML = "&#x270E;"; // Pencil symbol ✎
            editBtn.setAttribute("aria-label", `Edit task "${task.text}"`);

            // Create delete button
            const deleteBtn = document.createElement("button");
            deleteBtn.className = "delete-btn";
            deleteBtn.innerHTML = "&#x1F5D1;"; // Wastebasket emoji 🗑️
            deleteBtn.setAttribute("aria-label", `Delete task "${task.text}"`);

            // Append buttons to actions div
            actionsDiv.appendChild(completeBtn);
            actionsDiv.appendChild(editBtn);
            actionsDiv.appendChild(deleteBtn);

            // Append all parts to the list item
            li.appendChild(taskText);
            li.appendChild(actionsDiv);

            // Append list item to the task list
            taskList.appendChild(li);
          });

          // Show or hide the "Clear Completed" button
          clearCompletedBtn.style.display = hasCompletedTasks
            ? "block"
            : "none";
        };

        // Function to add a new task
        const addTask = (e) => {
          e.preventDefault(); // Prevent form from submitting and reloading the page

          const text = taskInput.value.trim(); // Get text and remove whitespace
          const priority = taskPriorityInput.value; // Get selected priority

          if (text === "") {
            // Don't add empty tasks
            return;
          }

          const tasks = getTasks();
          tasks.push({ text: text, completed: false, priority: priority }); // Include priority
          saveTasks(tasks);

          renderTasks(); // Re-render the list with the new task
          taskInput.value = ""; // Clear the input field
          taskInput.focus(); // Set focus back to the input
        };

        // Function to handle editing a task
        const editTask = (taskItem, index) => {
          const tasks = getTasks();
          const taskTextSpan = taskItem.querySelector(".task-text");
          const currentText = tasks[index].text;

          // Create an input field for editing
          const editInput = document.createElement("input");
          editInput.type = "text";
          editInput.value = currentText;
          editInput.className = "edit-task-input"; // For styling

          // Replace the text span with the input field
          taskTextSpan.replaceWith(editInput);
          editInput.focus();
          editInput.select(); // Select the text

          // Function to save the edited task
          const saveEdit = () => {
            const newText = editInput.value.trim();
            if (newText && newText !== currentText) {
              tasks[index].text = newText;
              saveTasks(tasks);
            }
            // Re-render to switch back to text span and update ARIA labels
            renderTasks();
          };

          // Save on blur
          editInput.addEventListener("blur", saveEdit);

          // Save on Enter key press
          editInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
              e.preventDefault(); // Prevent form submission if inside a form
              saveEdit();
            } else if (e.key === "Escape") {
              // Revert to original text and re-render (effectively cancels edit)
              renderTasks();
            }
          });
        };

        // Function to handle clicks on the task list (for completing or deleting)
        const handleListClick = (e) => {
          const target = e.target;
          const taskItem = target.closest(".task-item");

          if (!taskItem) return; // Exit if the click was not on a task item or its child

          const index = parseInt(taskItem.dataset.index, 10);
          const tasks = getTasks();

          // Check if the complete button or text was clicked
          if (
            target.classList.contains("complete-btn") ||
            target.classList.contains("task-text")
          ) {
            tasks[index].completed = !tasks[index].completed; // Toggle the completed status
          }

          // Check if the delete button was clicked
          if (target.classList.contains("delete-btn")) {
            tasks.splice(index, 1); // Remove the task from the array
          }

          // Check if the edit button was clicked
          if (target.classList.contains("edit-btn")) {
            // Prevent other actions if already editing an input in this item
            if (taskItem.querySelector(".edit-task-input")) return;
            editTask(taskItem, index);
            return; // Return early as editTask will handle re-rendering or its own save
          }

          saveTasks(tasks); // Save the updated tasks array
          renderTasks(); // Re-render the list
        };

        // Function to clear all completed tasks
        const clearCompletedTasks = () => {
          let tasks = getTasks();
          tasks = tasks.filter((task) => !task.completed);
          saveTasks(tasks);
          renderTasks();
        };

        // --- EVENT LISTENERS ---

        // Listen for form submission to add a new task
        taskForm.addEventListener("submit", addTask);

        // Listen for clicks on the task list for delete/complete actions (Event Delegation)
        taskList.addEventListener("click", handleListClick);

        // Listen for clicks on the "Clear Completed" button
        clearCompletedBtn.addEventListener("click", clearCompletedTasks);

        // --- INITIALIZATION ---

        // Render tasks on initial page load
        renderTasks();
      });
    </script>
  </body>
</html>
